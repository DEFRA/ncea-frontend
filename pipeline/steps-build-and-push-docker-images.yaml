steps:

- task: Docker@2
  displayName: 'Docker Build'
  condition: and(failed(), ne(variables['Build.Reason'], 'PullRequest'))
  inputs:
    command: build
    containerRegistry: $(ACR.ServiceConnection)
    repository: $(ACR.ContainerRepository)
    tags: '$(Build.BuildNumber)$(artifactNameSuffix)'

- task: Docker@2
  displayName: 'Docker Push'
  condition: |
    or(
        and(and(succeeded(), eq(variables.isMain, false)), eq(variables.isPullRequest, false)),
        and(succeeded(), eq(variables.isMain, true))
      )  
  inputs:
    command: push
    containerRegistry: $(ACR.ServiceConnection)
    repository: $(ACR.ContainerRepository)
    tags: '$(Build.BuildNumber)$(artifactNameSuffix)'
