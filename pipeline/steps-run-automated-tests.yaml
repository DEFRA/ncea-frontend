steps:

  - checkout: none

  - task: DownloadPipelineArtifact@2
    displayName: 'Download test tools'
    condition: succeeded()
    inputs:
      buildType: 'current'
      artifact: tests

  - task: CmdLine@2
    inputs:
      script: |
        echo "$(Pipeline.Workspace)"
        tree $(Pipeline.Workspace)

  - task: CmdLine@2
    inputs:
      script: |
        echo "$(System.DefaultWorkingDirectory)"
        tree $(System.DefaultWorkingDirectory)

  - task: VSTest@2
    displayName: Run tests
    inputs:
      platform: $(buildPlatform)
      configuration: $(buildConfiguration)
      testAssemblyVer2: |
        **\*Specs.dll
        !**\*TestAdapter.dll
        !**\obj\**  
      searchFolder: $(System.DefaultWorkingDirectory)/tests/net481
      testRunTitle: End-to-end tests - Test
      runSettingsFile: $(System.DefaultWorkingDirectory)/tests/net481/CI.runsettings
      # Handled via SpecFlow+ Runner
      rerunFailedTests: false
      publishRunAttachments: true
      uiTests: true 
      runInParallel: true