{% from 'govuk/components/button/macro.njk' import govukButton %}

<div class='govuk-section-break--visible'>
  <h2 class='govuk-heading-m results-stats govuk-!-margin-bottom-4'>
    {{searchResults.total}} results
  </h2>

  {% include 'partials/results/options.njk' %}
</div>

{% if searchResults.total %}
  <div class='search-result__items'>
    {% for item in searchResults.items %}
      <div class='govuk-section-break--visible search-result__item'>
        <h2 class='govuk-heading-m search-result__heading'>{{item.title}}</h2>
        <div class='search-result__parameter'>
          <span class='search-result__parameter-label search-result__published-label'>Published by</span>
          <span class='search-result__parameter-value search-result__published-value'>{{item.publishedBy}}</span>
        </div>
        {% if item.temporalExtentDetails.startDate or item.temporalExtentDetails.endDate %}
          <div class='search-result__parameter'>
            <span class='search-result__parameter-label search-result__study-label'>Study period</span>
            <span class='search-result__parameter-value search-result__study-value'>
              {% if item.temporalExtentDetails.startDate and item.temporalExtentDetails.endDate %}
                {{item.temporalExtentDetails.startDate | date('DD MMM YYYY')}} to {{item.temporalExtentDetails.endDate | date('DD MMM YYYY')}}
              {% elif item.temporalExtentDetails.startDate and not item.temporalExtentDetails.endDate %}
                {{item.temporalExtentDetails.startDate | date('DD MMM YYYY')}}
              {% elif not item.temporalExtentDetails.startDate and item.temporalExtentDetails.endDate %}
                {{item.temporalExtentDetails.endDate | date('DD MMM YYYY')}}
              {% endif %}
            </span>
          </div>
        {% endif %}
        <p class='search-result__content'>
          {{item.content}}
        </p>

        {% set openDataAttributes = {} %}
        {% if item.resourceLocator %}
          {% set openDataAttributes = openDataAttributes | merge({
            onclick: "openDataModal('" + item.resourceLocator + "')"
          }) %}
        {% else %}
          {% set openDataAttributes = openDataAttributes | merge({disabled: "true"}) %}
        {% endif %}

        <div class='govuk-button-group search-result__button-group'>
          {{ govukButton({
            text: 'Open data',
            attributes: openDataAttributes
          }) }}

          {{ govukButton({
            text: 'More info',
            classes: 'govuk-button--secondary'
          }) }}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

{% if searchResults.total and not hasError %}
  {%- include 'partials/open_data/template.njk' -%}
{% endif %}